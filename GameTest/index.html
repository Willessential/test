<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
    <title>Menu Game</title>

<!-- Favicon-->
<link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
<!-- Bootstrap icons-->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
<!-- Core theme CSS (includes Bootstrap)-->
<link href="css/styles.css" rel="stylesheet" />


    <style>
        .side-menu {
            position: fixed;
            top: 0;
            right: -1000px;
            width: 30%;
            height: 100%;
            background: #ddd;
            transition: right 0.5s ease;
            padding: 10px;
            overflow: auto;
        }

        .menu-item {
            cursor: pointer;
        }

        .menu-item img {
            width: 100px;
            height: 100px;
        }

        .crew-member, .leader {
            background: lightgrey;
            margin: 5px 0;
            padding: 10px;
            cursor: move;
        }

        .leader {
            background: blue;
            color: white;
        }

        .assign-btn {
            background-color: lightgrey;
            margin-left: 5px;
        }
        
		





        .menuItem{
            background-color: #cbccce;
             
            border-left: 6px solid #F58025!important;
            padding:10px;
            margin:5px;
        }

 

        .menuItemActiveProject{
            border-left: 6px solid #F58025!important;
          padding:10px;
          margin:5px;
      }

        .menuItemNewProject{
            border-left: 6px solid #F58025!important;
            padding:10px;
            margin:5px;
        }

        .menuItemMaintenanceProject{
            border-left: 6px solid #F58025!important;
            padding:10px;
            margin:5px;
        }

        .menuItemEmergencyProject{
            border-left: 6px solid #F58025!important;
            padding:10px;
            margin:5px;
        }




        #imageContain{
    background-color: black;
    width: 70%;
    
    display: flex;
    flex-wrap: wrap;
    
}

.imagebox {
    position: relative;
    text-align: center;
    color: white;
    width: 50%;
    box-sizing: border-box;
}

.imagebox img {
    width: 100%;
    height: auto;
}

.text {
    color:white;
    position: absolute;
    z-index: 2;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 24px;
    font-weight: bold;
    text-shadow: 2px 2px 4px #000000;

    
}

.imagebox.fullwidth{
    width: 100%;
}
    </style>
</head>
<body>



 <!-- Responsive navbar-->
 <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container px-5">
        <a class="navbar-brand" href="#!">DepotMaster</a>
        
    </div>
</nav>





<!-- Images -->

<div id="imageContain" class="text-center my-5">
    <table id="Table_01" width="1024" height="702" border="0" cellpadding="0" cellspacing="0">
        <tr>
            <td>
                <div style="position:relative">
                    <img src="img/test_01.png" onclick="toggleMenu('stocks')" width="256" height="258" alt="">
                    <p class="text">Stores</p>
                </div>
            </td>
            <td colspan="2">
                <div style="position:relative">
                    <img src="img/test_02.png" onclick="toggleMenu('vehicles')" width="442" height="258" alt="">
                    <p class="text">Fleet</p>
                </div>
            </td>
            <td colspan="2">
                <img src="img/test_03.png" width="325" height="258" alt="">
            </td>
            <td>
                <img src="img/spacer.gif" width="1" height="258" alt="">
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <img src="img/test_04.png" width="410" height="216" alt="">
            </td>
            <td colspan="2" rowspan="2">
                <div style="position:relative">
                    <img src="img/test_05.png" onclick="toggleMenu('office')" width="396" height="240" alt="">
                    <p class="text">Office</p>
                </div>
            </td>
            <td rowspan="3">
                <img src="img/test_06.png" width="217" height="443" alt="">
            </td>
            <td>
                <img src="img/spacer.gif" width="1" height="216" alt="">
            </td>
        </tr>
        <tr>
            <td colspan="2" rowspan="2">
                <div style="position:relative">
                    <img src="img/test_07.png" onclick="toggleMenu('crew')" width="410" height="227" alt="">
                    <p class="text">Crew</p>
                </div>
            </td>
            <td>
                <img src="img/spacer.gif" width="1" height="24" alt="">
            </td>
        </tr>
        <tr>
            <td>
                <img src="img/test_08.png" width="288" height="203" alt="">
            </td>
            <td>
                <img src="img/test_09.png" width="108" height="203" alt="">
            </td>
            <td>
                <img src="img/spacer.gif" width="1" height="203" alt="">
            </td>
        </tr>
        <tr>
            <td>
                <img src="img/spacer.gif" width="256" height="1" alt="">
            </td>
            <td>
                <img src="img/spacer.gif" width="154" height="1" alt="">
            </td>
            <td>
                <img src="img/spacer.gif" width="288" height="1" alt="">
            </td>
            <td>
                <img src="img/spacer.gif" width="108" height="1" alt="">
            </td>
            <td>
                <img src="img/spacer.gif" width="217" height="1" alt="">
            </td>
            <td></td>
        </tr>
    </table>
    </div>







  
  <!-- Modal -->
  <div class="modal modal-lg fade" id="welcomeModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">Resource supervisor needed</h5>
          
        </div>
        <div class="modal-body">
            <div class="row gx-5 justify-content-center">
                <div class="col-lg-12">
                    <div class="card mb-4">
                        <div class="card-body p-4">
                            <div class="d-flex">
                                <div class="flex-shrink-0"><img src="img/Headshot.PNG" alt=""></div>
                                <div class="ms-4">
                                    <p class="mb-1">Hi there, we need a Resource Supervisor to look after this depot. You'll have to manage jobs, make sure your Crew is setup correctly and they have the correct Fleet and Supplies they need.</p>
                                    <p>You will be scored on your efficiency and how well you react when the unexpected happens.</p>
                                    <p>You look ready!</p>
                                    <div class="small text-muted">- Bill</div>
                                </div>
                            </div>
                        </div>
                    </div>
      
                </div>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Accept job</button>
          
        </div>
      </div>
    </div>
  </div>













    

    <div id="stocks-menu" class="side-menu card p-3" style="width: 30%;">
        <h2 class="card-title">Stocks</h2>
    </div>

    <div id="vehicles-menu" class="side-menu card p-3" style="width: 30%;">
        <h2>Vehicles</h2>
    </div>

    <div id="office-menu" class="side-menu card p-3" style="width: 30%;">
        <h2>Office</h2>
        <div id="office-job-list">
          <!-- Office job content goes here -->
        </div>
    </div>

    <div id="crew-menu" class="side-menu card p-3" style="width: 30%;" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h2>Crew</h2>
    </div>




    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <script>


//modal on load
var myModal = new bootstrap.Modal(document.getElementById('welcomeModal'), {})
myModal.toggle()


        // Menu State Section
        var menuState = {
            stocks: false,
            vehicles: false,
            office: false,
            crew: false
        };
        
        // Vehicles Section
        var vehicles = [
            {vehicleType: 'Car', needsRepair: false},
            {vehicleType: 'Truck', needsRepair: true},
            {vehicleType: 'Tanker', needsRepair: false},
            {vehicleType: 'Van', needsRepair: false},
            {vehicleType: 'Jeep', needsRepair: true}
        ];
    
        // Crew Section
var crews = [
    {
        type: 'overhead',
        currentProject: '',
        members: [
            { name: 'Ali', experience: 95, happiness: 4, qualification: ['UG', 'OH'], leader: true, inTraining: false, trainingStartDay: null },
            { name: 'Ahmed', experience: 70, happiness: 4, qualification: ['UG', 'OH'], leader: false, inTraining: false, trainingStartDay: null },
            { name: 'Bob', experience: 65, happiness: 3, qualification: ['UG', 'OH'], leader: false, inTraining: false, trainingStartDay: null }
        ]
    },
    {
        type: 'underground',
        currentProject: '',
        members: [
            { name: 'John', experience: 93, happiness: 4, qualification: ['UG', 'OH'], leader: true, inTraining: false, trainingStartDay: null },
            { name: 'Alice', experience: 75, happiness: 4, qualification: ['UG', 'OH'], leader: false, inTraining: false, trainingStartDay: null },
            { name: 'Sarah', experience: 89, happiness: 4, qualification: ['UG', 'OH'], leader: false, inTraining: false, trainingStartDay: null }
        ]
    }
];
    
  
    
        // Stocks Section
        var stocks = {
            items: [
                {item: 'Crossarms', quantity: 10},
                {item: 'Poles', quantity: 20},
                {item: 'Transformer small', quantity: 4},
                {item: 'Transformer medium', quantity: 3},
                {item: 'Cement', quantity: 50},
                {item: 'Steel', quantity: 40},
                {item: 'Wire', quantity: 1},
                {item: 'Wire 2', quantity: 300}
            ]
        };
    
        // Stocks Menu Section
        function displayStocks() {
            let output = "<h2>Stocks</h2>";
            stocks.items.forEach((item, index) => {
                output += `<div class='menuItem'><p>Item: ${item.item} | Quantity: ${item.quantity}<button onclick="orderStock(${index})">Order</button></p></div>`;
            });
            document.getElementById("stocks-menu").innerHTML = output;
        }
    
        function orderStock(index) {
            stocks.items[index].quantity += 10;
            displayStocks();
        }
    
        // Vehicles Menu Section
        function displayVehicles() {
            let output = "<h2>Vehicles</h2>";
            vehicles.forEach((vehicle, index) => {
                output += `<div class='menuItem'><p>Vehicle: ${vehicle.vehicleType} | Needs Repair: ${vehicle.needsRepair}<button onclick="repairVehicle(${index})" ${vehicle.needsRepair ? "" : "disabled"}>Repair</button></p></div>`;
            });
            document.getElementById("vehicles-menu").innerHTML = output;
        }
    
        function repairVehicle(index) {
            vehicles[index].needsRepair = false;
            displayVehicles();
        }












// Office Section
var office = {
    activeProjects: ['Job 1'], // Existing projects
    newProjects: [
        {
            name: 'Project 1',
            requiredStocks: [{item: 'Cement', quantity: 2}, {item: 'Steel', quantity: 4}],
            requiredCrews: {type: 'underground', experience: 80}
        }, 
        {
            name: 'Project 2',
            requiredStocks: [{item: 'Metal', quantity: 3}, {item: 'Wire', quantity: 6}],
            requiredCrews: {type: 'overhead', experience: 85}
        }
        // More new projects...
    ],
    maintenanceProjects: [
        {
            name: 'Maintenance 1',
            requiredStocks: [{item: 'Wire', quantity: 5}],
            requiredCrews: {type: 'overhead', experience: 70}
        }
        // More maintenance projects...
    ],
    emergencyProjects: [
        {
            name: 'Emergency 1',
            requiredStocks: [{item: 'Parts', quantity: 5}],
            requiredCrews: {type: 'overhead', experience: 90}
        } 
        // More emergency projects...
    ]
};

function checkCrewAvailability(requiredType, requiredExp) {
    return crews.some(crew => crew.type === requiredType && crew.members.some(member => member.experience >= requiredExp) && crew.currentProject === '');
}

function assignProjectToCrew(requiredType, requiredExp, projectName) {
    for (var i = 0; i < crews.length; i++) {
        if (crews[i].type === requiredType && crews[i].members.some(member => member.experience >= requiredExp) && crews[i].currentProject === '') {
            crews[i].currentProject = projectName;
            return true;
        }
    }
    return false;
}

function createProjectDisplay(project, type, index) {
    let enoughStock = project.requiredStocks.every(stock => {
        let stockItem = stocks.items.find(item => item.item === stock.item);
        return stockItem && stockItem.quantity >= stock.quantity;
    });

    let enoughCrew = checkCrewAvailability(project.requiredCrews.type, project.requiredCrews.experience);

    return `<div class='menuItem${type.charAt(0).toUpperCase() + type.slice(1)} list-group-item list-group-item-action list-group-item-primary'>
                <p>${project.name}
                    (Requires: ${project.requiredStocks.map(stock => `${stock.quantity} ${stock.item}`).join(', ')}) and
                    ${project.requiredCrews.type} crew with experience ${project.requiredCrews.experience} )
                    <button onclick="activateProject('${type}', ${index})"${!enoughStock || !enoughCrew ? ' disabled' : ''}>${enoughStock && enoughCrew ? 'Activate' : 'Needs resources or suitable crew'}
                    </button>
                </p>
           </div>`;
}

function activateProject(type, index) {
    let project = office[type][index];

    let crewAvailable = assignProjectToCrew(project.requiredCrews.type, project.requiredCrews.experience, project.name);
    if(!crewAvailable) {
        return;
    }

    project.requiredStocks.forEach(stock => {
        let stockItem = stocks.items.find(item => item.item === stock.item);
        stockItem.quantity -= stock.quantity;
    });

    office[type] = office[type].filter((element, elementIndex) => elementIndex !== index);
    office.activeProjects.push(project.name);
    displayOffice();
}

function displayOffice() {
    let output = "<h2>Office</h2>";
    
    output += "<h3>Active Projects</h3>";
    office.activeProjects.forEach((project, index) => {
        output += `<div class='menuItemActiveProject list-group-item list-group-item-action list-group-item-success'><p>${project}</p></div>`;
    });
    
    output += "<h3>New Projects</h3>";
    office.newProjects.forEach((project, index) => {
        output += createProjectDisplay(project, 'newProjects', index);
    });
    
    output += "<h3>Maintenance Projects</h3>";
    office.maintenanceProjects.forEach((project, index) => {
        output += createProjectDisplay(project, 'maintenanceProjects', index);
    });
    
    output += "<h3>Emergency Projects</h3>";
    office.emergencyProjects.forEach((project, index) => {
        output += createProjectDisplay(project, 'emergencyProjects', index);
    });
    
    document.getElementById("office-menu").innerHTML = output;
}








 // Crew Section - 
function displayCrews() {
    let output = "<h2>Crew</h2>";
    crews.forEach((crew) => {
        output += `<h3>${crew.type.toUpperCase()}</h3>`;
        const sortedMembers = crew.members.sort((m1, m2) => m2.leader - m1.leader);
        const totalExperience = sortedMembers.reduce((total, member) => total + (member.inTraining ? 0 : member.experience), 0);
        const leaderExperience = sortedMembers[0].inTraining ? 0 : sortedMembers[0].experience;
        const effectivenessScore = totalExperience + (1.5 * leaderExperience);
        if (crew.currentProject) output += `<p>Current Project: ${crew.currentProject}</p>`;
        output += `<p>Effectiveness Score: ${effectivenessScore}</p>`;
        sortedMembers.forEach((member, idx) => {
            const trainButton = member.inTraining ? '<button disabled>Train</button>' : `<button onclick="startTraining('${crew.type}', ${idx})">Train</button>`;
            output += `<div class="${member.leader ? 'leader' : 'crew-member'} menuItem" draggable="${!member.inTraining}" ondragstart="dragStart(event)" id="crew-${crew.type}-member-${idx}">
            <p>Name: ${member.name} | Experience: ${member.experience} | Happiness Level: ${member.happiness} | Leader: ${member.leader} | In Training: ${member.inTraining}</p>${trainButton}</div>`;
        });
    });

    document.getElementById("crew-menu").innerHTML = output;
}

function startTraining(crewType, memberIndex) {
    const crew = crews.find(c => c.type === crewType);
    let member = crew.members[memberIndex];
    member.inTraining = true;
    member.trainingStartDay = new Date();
    member.experience += 10; // increase experience by 10
    member.happiness += 1; // increase happiness by 1
    displayCrews();
}

function dragStart(event) {
    event.dataTransfer.setData('text/plain', event.target.id);
}

function allowDrop(event) {
    event.preventDefault();
}

function drop(event) {
    event.preventDefault();
    const id = event.dataTransfer.getData('text/plain');
    const parts = id.split('-');
    const crewType = parts[1];
    const mIndex = parts[3];
    const crew = crews.find(c => c.type === crewType);
    const currentCrewLeaderIndex = crew.members.findIndex(member => member.leader);
    crew.members[currentCrewLeaderIndex].leader = false;
    crew.members[mIndex].leader = true;
    displayCrews();
    console.log(crews);
}






        // Menu Toggle Section
        function toggleMenu(option) {
            Object.keys(menuState).forEach((menu) => {
                if(menu === option) {
                    menuState[menu] = true;
                    document.getElementById(menu + "-menu").style.right = '0';
                    switch (menu) {
                        case "stocks":
                            displayStocks();
                            break;
                        case "vehicles":
                            displayVehicles();
                            break;
                        case "office":
                            displayOffice();
                            break;
                        case "crew":
                            displayCrews();
                            break;
                    }
                } else {
                    menuState[menu] = false;
                    document.getElementById(menu + "-menu").style.right = '-1000px';
                }
            });
        }
    </script>





</body>
</html>